<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Liga Femenina – No puedo, tengo pádel</title>
  <meta name="theme-color" content="#0f1115">
  <style>
    :root{ --bg:#0f1115; --panel:#161a22; --panel-2:#1e2430; --text:#f7f7f7; --muted:#b9c0d0; --accent:#ccff00; --danger:#ff5470; --ok:#32d296; --warn:#ffc107; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; background:linear-gradient(180deg,#0b0e13 0%, #111521 100%); color:var(--text)}
    h1,h2{margin:.2rem 0} h1{font-size:clamp(1.4rem,2.3vw,2.2rem)}
    .container{max-width:1100px; margin:0 auto; padding:20px}
    .grid{display:grid; grid-template-columns: 1fr; gap:16px}
    .card{background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%); border:1px solid #232a38; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card .hd{display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #222a36}
    .card .bd{padding:14px 16px}
    .pill{display:inline-flex; gap:.5rem; align-items:center; padding:.35rem .7rem; border-radius:999px; background:#1a202e; color:#b9c0d0; font-size:.85rem}
    input,select,button{padding:8px 10px; border-radius:10px; border:1px solid #2a3242; background:#131824; color:#f0f3fa; outline:none}
    input[type='text'], input[type='number'], select, button{width:100%}
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .primary{background:var(--accent); color:#0b0e13; border:none} .ghost{background:#121724} .danger{background:var(--danger); border:none} .ok{background:#32d296; color:#08130e}
    table{width:100%; border-collapse:collapse} th,td{padding:8px 6px; border-bottom:1px solid #252c3a; text-align:left} th{position:sticky; top:0; background:var(--panel)}
    .small{font-size:.85rem; color:#a8b2c6}
    .mobile-tabs{display:none; gap:8px; position:sticky; top:0; z-index:5; padding:8px 0}
    .mobile-tabs button{flex:1; padding:10px 12px; border-radius:999px; border:1px solid #2a3242; background:#0f1422; color:#cfd6e6; font-weight:700}
    .mobile-tabs button.active{background:var(--accent); color:#0b0e13; border-color:transparent}
    .mobile-section{display:block}
    @media (max-width:820px){.mobile-tabs{display:flex}.mobile-section{display:none}.mobile-section.active{display:block}}
    .flash{box-shadow:0 0 0 3px var(--accent) inset}

    /* Colapsables */
    .card.collapsed .bd{display:none;}
    details.round>summary{cursor:pointer;list-style:none;}

    /* === Match clean layout === */
    .match-card{padding:10px 12px}
    .match-top{display:flex;justify-content:flex-end;margin-bottom:6px}
    .match-top input[type="date"]{width:auto;min-width:140px}
    .match-row{display:grid;grid-template-columns:1fr auto;align-items:center;gap:14px;padding:10px 0;border-top:1px dashed #263044}
    .match-row:first-of-type{border-top:0}
    .match-name{font-weight:600;letter-spacing:.2px}
    .match-scores{display:flex;align-items:center;gap:8px}
    .score-pill{min-width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.15rem;background:#0f1422;border:1px solid #2a3242}
    .score-input{width:46px;text-align:center}
    .match-actions{display:flex;gap:10px;align-items:center;justify-content:flex-end;margin-top:10px}
    .trophy{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;border:2px solid #22d1b2}
    .trophy::before{content:"🏆"}
  </style>
</head>
<body>
  <div class="container">
    <header class="flex" style="justify-content:space-between;align-items:flex-start;gap:16px;margin-bottom:12px">
      <div>
        <h1>🏆 Liga Femenina – <span style="color:#ccff00">No puedo, tengo pádel</span></h1>
        <div class="small">Supabase + caché local. Cruces ida/vuelta, resultados y tabla.</div>
      </div>
      <div class="pill">🌐 Supabase • v11</div>
    </header>

    <nav class="mobile-tabs" id="mobileTabs">
      <button type="button" data-target="#sec-parejas">👥 Parejas</button>
      <button type="button" data-target="#sec-cuadros" class="active">🎾 Partidos</button>
      <button type="button" data-target="#sec-resumen">📋 Resumen</button>
      <button type="button" data-target="#sec-tabla">📊 Tabla</button>
    </nav>

    <section id="sec-parejas" class="grid mobile-section">
      <div class="card collapsed" id="pairsCard">
        <div class="hd">
          <strong>➕ Parejas / Jugadoras</strong>
          <div class="actions"><button id="togglePairs" class="ghost">Expandir</button></div>
        </div>
        <div class="bd">
          <div class="actions">
            <input id="teamName" placeholder="Ej: Jessi/Ck" style="max-width:260px" />
            <button id="addPair" class="primary">Agregar pareja</button>
            <button id="reloadAll" class="ghost">🔄 Recargar</button>
          </div>
          <div id="teamList" class="compact-list" style="margin-top:8px"></div>
        </div>
      </div>
    </section>

    <section id="sec-cuadros" class="grid mobile-section">
      <div class="card">
        <div class="hd"><strong>📆 Cuadros (Ida/Vuelta)</strong></div>
        <div class="bd"><div id="cards"></div></div>
      </div>
    </section>

    <section id="sec-resumen" class="grid mobile-section">
      <div class="card" id="summaryCard">
        <div class="hd"><strong>📋 Resumen de Partidos (Ida/Vuelta)</strong>
          <div class="actions"><button id="toggleSummary" class="btn">Colapsar</button></div>
        </div>
        <div class="bd" id="summary"></div>
      </div>
    </section>

    <section id="sec-tabla" class="grid mobile-section">
      <div class="card">
        <div class="hd"><strong>📊 Tabla</strong></div>
        <div class="bd"><table id="standings"></table></div>
      </div>
    </section>
  </div>

  <script type="module">
  // === Config Supabase ===
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
  const SUPABASE_URL='https://dyaptlmncbbmruyduerv.supabase.co';
  const SUPABASE_ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5YXB0bG1uY2JibXJ1eWR1ZXJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1Nzc0MjgsImV4cCI6MjA3NjE1MzQyOH0.5bSZuq8G1XW3LYoM92J5skRuUpnUQYbd_oKT3toTSlA';
  const LEAGUE_ID='lfnpd-2025';
  const supabase=createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
  const LS_KEY='liga-padel-cache-v11';
  let state={teams:[],matches:[],fixtures:{ida:[],vuelta:[]},dates:{}};

  async function reloadAll(){
    const {data:teams}=await supabase.from('teams').select('*').eq('league_id',LEAGUE_ID).order('position');
    state.teams=teams||[];
    renderTeams();
    renderCards();
  }

  async function onAddTeam(){
    const name=$('#teamName').value.trim();
    if(!name)return;
    await supabase.from('teams').insert({name,league_id:LEAGUE_ID});
    await reloadAll();
  }

  function renderTeams(){
    const list=$('#teamList');
    list.innerHTML=state.teams.map((t,i)=>`<div>${i+1}. ${t.name}</div>`).join('');
  }

  function makeCard(a,b,leg,ri,idx){
    const A=a,B=b;
    const uniq=[a,b].join('__')+'_'+leg+'_'+ri+'_'+idx;
    return `
    <div class="card match-card">
      <div class="bd">
        <div class="match-top small">📅 <input id="${uniq}_date" type="date"></div>
        <div class="match-row"><div class="match-name">${A}</div>
          <div class="match-scores">
            <span class="trophy"></span>
            <input class="score-pill score-input" type="number" placeholder="-">
            <input class="score-pill score-input" type="number" placeholder="-">
          </div></div>
        <div class="match-row"><div class="match-name">${B}</div>
          <div class="match-scores">
            <span class="trophy"></span>
            <input class="score-pill score-input" type="number" placeholder="-">
            <input class="score-pill score-input" type="number" placeholder="-">
          </div></div>
        <div class="match-actions">
          <label class="small"><input type="checkbox"> WO</label>
          <button class="ok">Guardar</button>
        </div>
      </div>
    </div>`;
  }

  function renderCards(){
    const cards=$('#cards');
    const teams=state.teams.map(t=>t.name);
    if(teams.length<2){cards.innerHTML='<div class="small">Agrega parejas primero.</div>';return;}
    cards.innerHTML=makeCard(teams[0],teams[1],'ida',0,0);
  }

  $('#addPair').addEventListener('click',onAddTeam);
  reloadAll();

  // --- Botón Colapsar / Expandir Parejas ---
  (function(){
    const btn=document.getElementById('togglePairs');
    const card=document.getElementById('pairsCard');
    const KEY='pairsCollapsed';
    const saved=localStorage.getItem(KEY);
    const start=saved===null?true:(saved==='true');
    if(start){card.classList.add('collapsed');btn.textContent='Expandir';}
    else{btn.textContent='Colapsar';}
    btn.addEventListener('click',()=>{
      const isCollapsed=card.classList.toggle('collapsed');
      btn.textContent=isCollapsed?'Expandir':'Colapsar';
      localStorage.setItem(KEY,String(isCollapsed));
    });
  })();

  // --- Botón Colapsar / Expandir Resumen ---
  (function(){
    const btn=document.getElementById('toggleSummary');
    const card=document.getElementById('summaryCard');
    const KEY='summaryCollapsed';
    const saved=localStorage.getItem(KEY)==='true';
    if(saved){card.classList.add('collapsed');btn.textContent='Expandir';}
    btn.addEventListener('click',()=>{
      const isCollapsed=card.classList.toggle('collapsed');
      btn.textContent=isCollapsed?'Expandir':'Colapsar';
      localStorage.setItem(KEY,String(isCollapsed));
    });
  })();
  </script>
</body>
</html>
